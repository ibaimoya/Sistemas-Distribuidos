<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Mis Pokémon</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
    <body class="bg-light">
        <div class="container mt-4">
            <h2 class="mb-3">Mis Pokémon guardados</h2>
        
            <div id="listaPokemons">
            <div th:each="p : ${pokemons}" class="pokemon-item card mb-3"
                th:data-id="${p.id}">
                <div class="row g-0 align-items-center p-2">
                <div class="col-3 col-md-2 text-center">
                    <img th:src="${p.imagenUrl}" class="img-fluid" style="max-height:90px">
                </div>
                <div class="col">
                    <h5 class="mb-1 text-capitalize" th:text="${p.nombre}">pikachu</h5>
                    <small class="text-muted">N.º&nbsp;<span th:text="${p.numero}">25</span></small>
                </div>
        
                <!-- Botón borrar -->
                <div class="col-auto">
                    <button class="btn btn-sm btn-danger delete-btn">
                    <i class="bi bi-trash"></i>
                    </button>
                </div>
                </div>
            </div>
            </div>
        </div>
    </body>
    <script>
        document.addEventListener('click', async (e) => {
        const btn = e.target.closest('.delete-btn');
        if (!btn) return;                      // clic fuera del botón
        
        const card = btn.closest('.pokemon-item');
        const id   = card.dataset.id;
        
        if (!confirm('¿Eliminar este Pokémon guardado?')) return;
        
        try {
            const res = await fetch(`/api/pokemon/${id}`, { method: 'DELETE' });
            if (res.ok) {
            card.remove();                      // quita la tarjeta del DOM
            } else {
            const txt = await res.text();
            alert('No se pudo borrar: ' + txt);
            }
        } catch (err) {
            console.error(err);
            alert('Error de conexión al borrar');
        }
        });
    </script>
</html>